# 第四章 大数据在智慧城市应用中的关键技术

## 4.1 数据生命周期管理

数据生命周期管理包括数据的产生、维护、销毁等各个阶段，其中需要元数据（Metadata）对各个数据阶段进行控制

## 4.2 大数据采集

作为一款协助 RDBMS 与 Hadoop 之间进行数据传导的项目，

### 4.2.1 Sqoop从关系型数据库到大数据平台

在大数据时代，数据无疑是智慧城市建设的核心资产之一，若能盘活好数据，则能使城市治理、城市决策和市民服务等方方面面受益匪浅；反之，则容易导致其核心竞争力下降，甚至衰落。

在建设智慧城市过程中，我们需要尽可能的使用以前的IT遗产，其中最重要的就是运行了很多年的城市业务系统所积累起得海量的数据，而这些数据几乎都是存在在传统的关系型数据库中，将这部分数据集中到大数据平台的工作就显得非常重要。

Sqoop是由Apache组织发布的，一个用来将Hadoop和关系型数据库中的数据相互转移的工具，可以将一个标准的关系型数据库（例如 ： MySQL、Oracle、SQL Server等）中的数据导进到Hadoop的HDFS中，也可以将HDFS的数据导进到关系型数据库中。自从2009年5月作为Hadoop的补丁首次发布以来，Apache Sqoop逐步迅速发展，并于 2012年3月份正式成为Apache的顶级项目。实际上，Sqoop还能帮助用户在关系型数据库和HBase与Hive之间实现数据交流。 

Sqoop旨在协助关系型数据库与Hadoop之间进行高效的大数据交流。用户可以在Sqoop的帮助下，轻松地把关系型数据库的数据导入到Hadoop与其相关的系统 ( 如 HBase 和 Hive) 中；同时也可以把数据从Hadoop系统里抽取并导出到关系型数据库里。

理论上，Sqoop支持任何一款支持JDBC规范的数据库，如DB2、MySQL等。Sqoop能够将关系型数据库的数据导入到 HDFS上，并保存为多种文件类型。常见的有定界文本类型，Avro二进制类型以及SequenceFiles类型。

### 4.2.2 基于隐私保护的大数据筛选和脱敏

海量的智慧城市数据容纳了众多的市民、企事业单位的数据，其中包含了一些个人信息，企事业单位知识产权信息等。对数据的利用必须要考虑到对个人隐私的保护。我们采用静态数据脱敏和动态触发式数据脱敏技术相结合的方式，将对数据的筛选、加载的工作进行层层监察，确保数据的安全。

数据脱敏层主要涉及数据屏蔽（Data Masking）技术，也被称为数据混淆、数据保密、数据消毒、数据扰频、数据匿名化和数据认证技术，指对敏感信息通过脱敏规则进行数据的变形或加密，实现敏感隐私数据的可靠保护。

可采用的数据屏蔽技术包括基于数据抽取、转换和加载（Extract-Transform-Load，ETL）的静态数据脱敏（Static Data Masking，SDM）、触发式的动态数据脱敏（Dynamic Data Masking）和Proxy协议式的动态数据脱敏（Proxy Data Masking，PDM）技术。数据脱敏将重点定义一系列屏蔽触发规则。


## 4.3 海量数据存储

海量智慧城市数据的高效存储是整体智慧城市系统的坚实基础，我们推荐采用云计算的数据管理平台实现对海量数据的存储。云计算数据平台（基于分布式文件系统）主要实现对海量结构化、非结构化数据的高效存储、访问、共享交换、处理，为上层数据分析（数据挖掘）提供高性能的分布式数据管理能力。

对海量智慧城市数据的优化存储离不开几个功能：

* 云数据管理中间件：通过整合传统关系数据库、NoSQL数据库、文件系统等异构存储模式，实现按需按数据特性存储，并通过统一的数据总线实现跨存储设施的统一访问。此外，借助并行数据处理技术对吞吐量，并发量以及可用性进行增强。海量的智慧城市系统的数据种类有很多，针对不同的业务需求和数据特点，我们会采用了不同的存储方式。比如：Key-Value存储系统、列式存储系统、HDFS的分布式存储等。这些不同的存储系统为数据的统一管理和调用造成了很大的障碍。我们基于对海量医疗数据的深刻理解，面向不同性质的存储系统的差异，为数据的统一访问封装了一个数据访问统一接口，它将不同数据存储系统的差异进行封装，提供了一个统一的访问形式，降低了异构数据存储的管理和访问难度。
* 海量数据存储平台：关注于非结构化数据存储和管理，通过统一存储实现有效利用企业存储资源，基于多个节点提供面向海量非结构化数据的高效存储平台，提供统一海量内容管理能力。￼存储设施服务是在IaaS基础设施之上建立的存储服务。引入读写分离技术，将已有的数据库作为核心业务库，提供实时写操作，而对于更为频繁的读操作，则需建立索引库来实现。此外，存储设施服务中还加入了缓存机制来提高性能，从而加速应用访问。

### 4.3.1 基于HDFS的分布式数据仓库



### 4.3.2 HBase列式数据库存储


## 4.4 大数据处理【10%】

大数据处理是建立在海量数据存储之上的，为应用和访问海量数据存储设施提供了透明化的处理策略，可以有效屏蔽存取细节。上层数据分析服务无需关注数据的来源和数据的存储模式，以统一的视图和操作模式完成海量数据的存取。包括以下方面：

* 元数据解析：数据访问服务对外将提供统一的CRUD元数据描述，而元数据解析服务负责将元数据解析为平台可理解的数据访问需求，以及面向不同存储设施的本地化语言；
* 路由控制：路由控制维护了逻辑存储设施到物理存储设施的映射关系，负责将数据存取请求分发到相应存储设施中；
* 对象映射：数据访问服务基于面向对象技术提供了简单化存取对象映射，可以用于高层语言和存储设施数据片段的转换，加速应用实施；
* 类型转换：提供了对象与数据间，不同数据结构间以及存储设施私有数据类型的转换；
* 事务：提供了面向写操作的ACID保证机制，支持跨存储设施的协同事务；
* 执行合并：执行合并直接与存储设施交互，基于数据存取的语义指令，分别和不同存储设施交互，并完成不同数据源数据的合并与对象化映射，返回上层服务。### 4.4.1 元数据解析
### 4.4.2 路由控制

## 4.5 大数据分析【40%】

### 4.5.1 搜索引擎



### 4.5.2 多维分析

基于统计模型和规则从海量智慧城市运营事实数据提取隐性数据，根据关注度的切分对目标数据进行筛选、合并运算。多维分析针对扩展SQL提供层次化查询，同时基于Cube定义映射具体的结果数据，并对结果进行合并化处理。当查询涉及的Cube不存在时，将及时调度ETL服务完成结果数据获取；

我们还需要针对常规大数据分析模型参照OLAP技术提供了面向结构化和非结构化的统一CUBE管理支持，提供了基于扩展SQL的面向维度，度量等CUBE信息的定义和处理语言，基于ETL服务将原始数据提取、转换为结果数据并加载至目标存储（采用NoSQL）形成主题库，在实际分析中，结果表直接提供数据查询服务。在数据一致性方面，基于可追溯性原则，已产生的CUBE对应的结果数据不做更新，而是通过事实数据的变更产生基于时间的CUBE。

#### 4.5.2.1 面向主题的数据结构

作为传统数据仓库的基本特征，也是数据仓库必须具备的功能。在智慧城市项目中的维度建模中，往往一些维度不是预定义的，这些内容会进行动态的调整，所以这里的多维模型支持在系统运行时动态添加维度。

### 4.5.3 数据挖掘【60%】

面向智慧城市数据的深度分析，预警与预测，需要借助数据挖掘技术实现。我们需要提供了包括聚类、分类、关联规则、协同过滤等机器学习算法的统一注册，应用与注销管理，用于针对特定数据集的挖掘分析。

基于机器学习算法从海里智慧城市数据中提取潜在价值数据，提供面向相关性、推荐、建议、预警等应用分析服务。挖掘分析过程包括数据准备、数据开采、结果表达和解释三个阶段：

* 数据准备：具体包含数据集成、选择和预处理三个方面。数据集成将云存储环境中的事实数据进行合并处理，解决语义模糊性、处理数据中的遗漏和清洗脏数据等；数据选择的目的是辨别出需要分析的数据集合，缩小处理范围，提高数据挖掘的质量；数据预处理是为了克服目前数据挖掘工具的局限性。
* 数据开采：基于具体的机器学习算法，通过对的数据分类、度量处理发现新知识。
* 结果的表达和解释：根据医疗数据挖掘业务要求，对提取的信息进行分析，把最有价值的信息区分出来，并借助图表等可视化工具展现。为了能更真实反映分析效果，往往需要重复上述过程。

#### 4.5.3.1 大数据下的频繁模式挖掘技术

频繁模式挖掘是数据挖掘领域一项最重要的技术。频繁模式挖掘搜索给定数据集中反复出现的联系。在传统数据集中，频繁模式挖掘技术已经得到了充分的研究，经典算法有Apriori算法、FP-Growth算法，垂直数据格式数据挖掘算法，闭频繁项集挖掘以及这些算法的改进算法和变种算法。

对于智慧城市中的大数据，传统的频繁模式和关联规则挖掘技术将遇到很多问题：首先，由于频繁k+1候选集的生成使用频繁k项集的自连接生成，因此大数据产生的候选集数量十分巨大，其增长速度是指数级的；其次，为了计算得到所有的频繁项集，算法必须反复迭代搜索数据库，导致高额的I/O开销。
考虑到以上问题，并行化的挖掘技术是最佳选择。现有的并行算法包括CD（Count Distribution），CAD（Candidate Distribution）和DD（Data Distribution），这些算法的缺点是高昂的通讯开销以及同步问题。Map-Reduce框架在解决以上问题时具有优势，首先Map-Reduce框架能够自动解决失效，其次Map-Reduce将程序开发者从复杂的编程中解放并提高系统的容错能力。Map-Reduce提供简化的应用模型，在分布式的环境里提高Apriori算法性能，将一个庞大的问题自动切割成小问题，在不同节点并行执行。	

#### 4.5.3.2 大数据下的聚类分析方法

将物理或抽象对象的集合分成相似的对象类的过程成为聚类。聚类是一种重要的人类活动，也是目前应用最广泛的数据挖掘技术，同时也是一个富有挑战性的研究领域。传统聚类技术主要有基于划分的K均值算法和K中心点算法；基于层次的算法包括，利用层次方法的平衡迭代规约的BIRCH算法，分类属性的层次聚类ROCK算法和利用动态建模的Chameleon算法；基于密度的算法包括，基于高密度联通区域的DBSCAN算法，通过点排序识别聚类结构的OPTICS算法和基于密度分布函数的DENCLUE算法；基于网格的算法包括，统计信息网格STING算法，利用小波变换的WaveCluster算法；基于模型的算法有期望最大化方法、概念聚类和神经网络方法；高维聚类有，维增长子空间聚类CLIQUE算法和维规约子空间聚类PROCLUS算法。
对于智慧城市大数据集，传统聚类算法有很大的不足。根据最近的调查分析，现存的聚类分析算法应用于数量级是TB或者PB的数据集是不实际的，因为目前最大的单个磁盘在1-2TB，而仅仅读1TB的数据（5GB/min传输速率，eSATA磁盘）就需要超过3小时。现有的聚类算法是串行的，虽然不适合并行环境，但是作为并行算法在每个磁盘上的“插件”是一种不错的技术选择。由于目前磁盘容量的限制，将数据存于多个磁盘是必然的。对于智慧城市大数据，目前的技术瓶颈是I/O开销和网络开销。对于算法的设计主要有：算法的设计是否考虑到磁盘传输延迟和网络传输延迟两方面，并能够自动平衡达到最佳运行效果；算法的有效性，由于并行聚类算法不同于串行算法，局部聚类结果不同于全局聚类，因此算法是否可靠有效是一个重要问题；另外，算法可扩展性也是性能的一个重要指标。
#### 4.5.3.3 大数据下的分类和预测算法
分类和数值预测是预测问题的两种主要类型。目前主要算法有用决策树归纳分类，贝叶斯分类，基于规则的分类，用后向传播分类，支持向量机，近邻学习分类，线性和非线性回归等方法。大数据下的预测算法工具有Google提供的Google Parallelism R Package。这个框架允许用户使用高级语言编写程序完成将数据拆分并分发到不同位于Google数据中心机器上的任务。预测结果会以可扩展的，分布式的方式从不同的数据存储设备收集得到。#### 4.5.3.4 大数据下的序列挖掘算法
序列挖掘主要包含时间序列挖掘、交易序列挖掘和生物序列挖掘。时间序列挖掘是数据挖掘技术的一个重要部分。主要有趋势分析和相似性搜索。趋势分析包括长期运动，周期变化，季节性运动和不规则运动。趋势分析的算法包括自相关分析，n阶加权移动平均等。时间序列的相似性搜索包括时间序列相似性查询分为全序列匹配和子序列匹配两种方式：

* 查询序列和被查询序列的长度相同，称为全序列匹配；
* 在较长的时间序列中，找出与查询序列相似的子序列，称为子序列匹配。

根据查询标准，时间序列相似查询可以分为两类 ：

* 最近邻查询，找出k个与查询序列最相似的序列或子序列；
* 范围查询，找出与查询序列的距离不大于允许误差的序列或子序列。

序列模式挖掘是挖掘频繁出现的有序事件或子序列，经典算法有GSP、SPADE和PrefixSpan算法。生物学序列比对主要用到马尔科夫模型、隐马尔科夫等。
序列挖掘是一种经常被用于并行化数据挖掘算法，包括Monte Carlo路径模拟等。但是大数据下，目前的算法仍然不能满足需求。下一代的DNA序列数据将以空前的速度增长，BLAST是目前最常用的序列挖掘系统，科技人员已经着手于研究基于MapReduce的BlastReduce。

## 4.6 智慧城市大数据决策分析【80%】

从一个城市范围看，智慧城市的核心是智慧。它要求将从不同来源获得的信息，通过快速、专业、智能的分析处理，给出一个可度量的、可评估的科学决策方案。

智慧城市中大数据相关的关键技术包括融合多领域信息的数据知识模型、面向智慧城市决策支持的分布式海量数据的管理技术、辅助决策模型的智能组合技术、高性能多用户协同的辅助决策技术等。

### 4.6.1 融合多领域信息的数据知识模型

对与城市综合管理相关的各领域（如交通、卫生、食品、环境、能源、规划等）数据提供统一的数据采集、整理、处理等支撑服务；其次，对城市综合管理决策可能涉及的多领域的需求，在标准统一的领域数据知识模型的基础上，建立面向不同主题的多领域数据知识模型，如，卫生中疾病的发生可能与环境变化、食品污染、药品短缺等相关，食品价格的波动可能与交通物流状况、环境带来的产量变化等相关；最后，在建立面向领域的和面向主题（涉及多领域）的数据知识模型的基础上，形成多领域多层次数据知识模型结构。相关技术包括：

* 数据和知识表达形式的规范性：在对交通、卫生、食品、环境、能源、规划等领域知识研究的基础上，提出科学、统一、规范的知识信息表达形式，为进行多领域综合分析提供统一的数据基础；
* 面向领域的数据知识模型：通过对交通、卫生、食品、环境、能源、规划等不同领域的关键业务和数据类型进行研究，建立面向不同领域的、规范的数据知识模型；
* 面向主题（多领域）的数据知识模型：在规范的数据和知识表达形式的基础上，研究面向多领域的综合分析业务需求，建立面向主题（多领域）的综合数据知识模型，如流行病分析、价格波动分析、社会稳定分析、城市规划决策等主题；
* 多领域多层次数据知识模型结构：在面向领域和面向主题的数据知识模型的基础上，研究多层次的统一的数据知识模型，为建立智能化城市综合管理辅助决策模型提供技术支撑。

### 4.6.2 面向智慧城市决策支持的分布式海量数据的管理技术

针对智能化城市综合管理中涉及的多领域海量数据，通过对城市信息化相关的海量异构数据的集成、存储、查询分析和挖掘技术和基于海量数据的决策分析技术进行研究，实现海量数据管理和决策分析的双向耦合，为决策支持提供数据管理层面的有效支撑。包括：

* 分布式海量数据的平台：针对数据知识模型和决策分析模型，利用智慧城市云计算相关技术，研究分布式数据平台相关技术，包括统一访问技术、路由策略技术、跨存储资源访问技术、事务技术等，建立面向智能化城市综合管理的分布式数据平台，提供高效的数据组织、存储和访问的机制。城市管理中涉及大量的实时数据应用。这些应用使得数据量呈现快速增长的趋势。另一特点是存在突发性的数据爆发。因此，需能够支持存储平台的负载均衡和弹性伸缩，主要包括云平台通用的负载均衡和弹性伸缩技术，模型数据的分布式存储和基于查询频率的负载均衡技术。
* 基于云计算的海量异构数据的存储管理技术：城市管理原始数据包含大量的结构化、半结构化和非结构化数据。模型相关数据包含多种表示方法：向量数据、序列数据、图数据。目前的云数据服务技术主要针对结构化数据和基于Key-Value的文本数据，而对于序列数据、图数据这些类型没有很好的支持技术。项目将基于Hbase、HIVE等NoSQL云数据库系统，研究Hadoop平台上数据管理与访问的技术，主要包括面向多维度聚集查询的数据的分割与分布策略、大规模聚集查询的分布式实施方法、以流数据为代表的海量监测数据的快速写入与基于（Key,Value）方式的分布式存储与访问方法、面向曲线特征的监测数据组织方法。
* 分布式决策模型：研究面向海量异构数据的智能城市的决策模型。在分布式计算框架MapReduce的基础上，对决策模型（多元回归、神经网络、主成分分析等）进行研究，使其具有分布式计算的能力，能够对分布环境下的数据库进行分析，以提高算法的运算能力。
* 流数据挖掘技术：智能城市分析的另一特点是数据的快速性，因此需利用流数据分析和挖掘算法，构建快速实时的决策分析模型。针对智能化城市综合管理中的海量实时数据“连续、有序、变化、快速、海量”的特点，采用分类、聚类、频繁模式挖掘等方法来处理城市不同领域的监测数据。

### 4.6.3 辅助决策模型的智能组合技术

智能化城市综合管理中，有多种面向领域和面向主题（多领域）的决策分析模型，这些决策模型的输入，不仅有获取的城市管理基础数据，而且有其它模型的分析结果，因此需要建立针对模型的规范化描述，使模型分析的结果也可以满足数据知识模型体系的数据标准，从而能够为其它决策分析模型所利用，在此基础上能够建立模型链的实例化应用，扩展辅助决策支持的范围，真正发挥多层级辅助决策支持的能力。包括：

* 决策模型标准化：研究针对决策模型的标准规范，规范系统中模型的建立、描述、注册、输入和输出等内容，使相关模型能够组成模型链；
* 模型链建立与实例化：通过对智能化城市综合管理业务需求的分析，建立对应某主题或过程的模型链，通过自动或交互式手动的方式实现模型链的实例化和执行，例如，发生应急事件时的预测结果，可以用来分析是否会产生其它次生、衍生事件；
* 模型链评估与优化：通过建立模型链比较、评估标准，来分析针对同一主题或过程的不同模型链的优劣，同时可以通过参数调整或手动的方式来对模型链进行优化。

### 4.6.4 高性能多用户协同的辅助决策技术

智能化城市综合管理中积累了各领域的海量历史数据，对这些数据进行综合分析能够提供智能辅助决策的功能。很多智能辅助决策算法的计算结果与地理信息、空间信息关系紧密，通过可视化技术，可以更直观、有效的方式将分析结果展示给用户，同时，将分析结果按时间切片顺序进行展现，能够模拟出动态演变发展的过程，显示出不同现象与动态变化之间的关系。主要包括：

* 决策模型的可视化展现技术：将决策模型与具体的业务需求相结合，对实时动态信息或历史信息进行分析，分析结果与GIS、虚拟现实环境相结合，能够进行基于场景的可视化展现，如，危险气体扩散模型，地铁客流量预测模型等；
* 可视化动态分析模型：以时间切片为依据，将决策模型的可视化展现结果顺序的展现给用户，是用户对整个的发展演变过程有最直观的认识，既可以是历史数据的分析，也可以是对事态发展的预测。同时，用户可以通过调整决策模型的参数、最优分析评估等手段，来获得不同的事态发展过程展示，提高系统的智能化水平。如，危险气体在不同条件下的影响范围趋势、地铁客流量在不同站点、不同时间段条件下的预测分析等；
* 可视化智能决策方案：在对获取的历史和动态信息分析的基础上，系统结合业务知识，自动的生成当前信息的可视化决策方案，同时，用户可以通过参数调整等手段更新决策方案。如，危险气体泄漏事件中的可视化智能救援方案、基于历史信息的城市优化规划决策方案等。

## 4.7 数据展现与可视化

